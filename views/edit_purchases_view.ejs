<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('./partials/head'); -%>

</head>

<body>
    <!--*******************
        Preloader start
    ********************-->
    <div id="preloader">
        <div class="sk-three-bounce">
            <div class="sk-child sk-bounce1"></div>
            <div class="sk-child sk-bounce2"></div>
            <div class="sk-child sk-bounce3"></div>
        </div>
    </div>
    <!--*******************
        Preloader end
    ********************-->

    <!--**********************************
        Main wrapper start
    ***********************************-->
    <div id="main-wrapper">

        <!--**********************************
            Nav header start
        ***********************************-->
        <%- include('./partials/header_logo'); -%>

            <!--**********************************
            Nav header end
        ***********************************-->

            <!--**********************************
            Header start
        ***********************************-->
            <%- include('./partials/header',{titel: "Incoming for Raw Materials"}); -%>

                <!--**********************************
            Header end ti-comment-alt
        ***********************************-->

                <!--**********************************
            Sidebar start
        ***********************************-->
                <%- include('./partials/sidebar'); -%>

                    <!--**********************************
            Sidebar end
        ***********************************-->

                    <!--**********************************
            Content body start
        ***********************************-->
                    <div class="content-body">
                        <div class="container-fluid">

                            <!-- row -->
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h4 class="card-title"><%= language.edit_purchase %> </h4>
                                            <button type="button" class="btn btn-rounded btn-outline-info"
                                                onclick="history.back()"><i class="la la-undo"></i> <%= language.go_back %></button>
                                        </div>

                                        <div class="card-body">
                                            
                                            <a href="/picking_list/pdf_puchases/<%= user._id %>" id="picklist" data-id="<%= user._id %>"
                                                    class="btn btn-warning btn-sm" target="_blank">
                                                    <i class="feather icon-printer"></i>
                                            Print Incoming</a>
                                        </div>


                                        <div class="card-body">
                                            <div class="form-validation">

                                                <form class="needs-validation"
                                                    action="/all_purchases/preview/<%= user._id %>" method="post" id="form">

                                                    <div class="row mb-3">
                                                        <div class="col-xl-3 col-sm-6">
                                                            <div class="form-group">
                                                                <label for="invoice_no">Document Number </label>
                                                                <input type="text" name="invoice" class="form-control" value="<%= user.invoice %>"
                                                                    id="invoice" readonly>
                                                            </div>
                                                        </div>

                                                        <div class="col-xl-3 col-sm-6">
                                                            <div class="form-group">
                                                                <label for="invoice_no">Supplier/Client Ref Number </label>
                                                                <input type="text" name="SCRN" class="form-control" value="<%= user.SCRN %>"
                                                                    id="SCRN" readonly>
                                                            </div>
                                                        </div>


                                                        <div class="col-xl-3 col-sm-6">
                                                            <div class="form-group">
                                                                <label class="form-label">PO number</label>
                                                                <input type="text" class="form-control" name="PO_number" value="<%= user.POnumber %>" readonly>
                                                            </div>
                                                        </div>




                                                        <div class="col-xl-3 col-sm-6">
                                                            <div class="form-group">
                                                                <label for="invoice_no"><%= language.supplier %> </label>
                                                                <input type="text" class="form-control" name="suppliers" id="suppliers" value="<%= user.suppliers %>" readonly>
                                                            </div>
                                                        </div>

                                                        <div class="col-xl-3 col-sm-6">
                                                            <div class="form-group">
                                                                <label for="invoice_no"><%= language.date %> </label>
                                                                <input type="date" name="date" class="form-control" value="<%= user.date %>"
                                                                    id="date" readonly>
                                                            </div>
                                                        </div>


                                                        <div class="col-xl-3 col-sm-6">
                                                            <div class="form-group">
                                                                <label for="invoice_no"><%= language.warehouse %> </label>
                                                                <input type="text" name="warehouse_name" class="form-control" value="<%= user.warehouse_name %>" id="warehouse_name" name="warehouse_name" readonly>
                                                            </div>
                                                        </div>


                                                        <div class="col-xl-3 col-sm-6">
                                                            <div class="form-group">
                                                                <label for="invoice_no">Room  <span
                                                                        class="text-red">*</span></label>
                                                            
                                                                <input type="text" name="Room_name" class="form-control" value="<%= user.room %>" id="Room_name" name="Room_name" readonly>
                                                            </div>
                                                        </div>
                                             
                                                    </div>

           
                                                    <div class="col-xl-12">
                                                        <div class="table-responsive">
                                                            <table class="table primary-table-bordered">
                                                                <thead class="thead-primary">
                                                                    <tr>
                                                                        <th scope="col">Item Code </th>
                                                                        <th scope="col">Item Description </th>
                                                                        <th scope="col">Primary Barcode </th>
                                                                        <th scope="col">Batch Code </th>
                                                                        <th scope="col">Production date </th>
                                                                        <th scope="col">Expiry date </th>
                                                                        <!-- <th scope="col">Requested <%= language.quantity %> </th> -->
                                                                        <th scope="col"><%= language.quantity %> </th>
                                                                        <th scope="col">Unit of Measure </th>
                                                                        <th scope="col">Conversion</th>
                                                                        <th scope="col">Room Assign</th>
                                                                        <!-- <th scope="col">Bay </th>
                                                                        <th scope="col">Bin </th>
                                                                        <th scope="col">Type </th> -->
                                                                        <th scope="col"> Location</th>
                                                                        <th scope="col"> Delivery Code</th>
                                                                        <!-- <th scope="col"> Delivery Date</th>
                                                                        <th scope="col"> Delivery Code</th> -->
                                                                    </tr>
                                                                </thead>
                                                                <tbody id="tblPage_new">
                                                                    <% var x = 1; %>
                                                                    <% user.product.forEach((users)=> {   %>
                                                                        
                                                                        <tr>

                                                                            <td>
                                                                                <div class="input-group"> 
                                                                                    <input type="text" name="prod_code" class="form-control"  style="width: 125px;" id="prod_code<%= users.product_code+x %>" value="<%= users.product_code %>" readonly> 
                                                                                </div>
                                                                            </td>



                                                                            <td>
                                                                                <input type="text" name="prod_name" class="form-control" style="width: 380px;" value="<%= users.product_name %>" readonly>
                                                                            </td>
                                                                            
                                                                            <td>
                                                                            <div class="input-group"> 
                                                                                <input type="text" name="primary_code" class="form-control" style="width: 150px;" id="primary_code<%= users.product_code+x %>" value="<%= users.primary_code %>" readonly> 
                                                                            </div>
                                                                            </td>


                                                                            <td>
                                                                                <div class="input-group"> 
                                                                                    <input type="text" name="batch_code" class="form-control" style="width: 250px;" id="batch_code<%= users.product_code+x %>" value="<%= users.batch_code %>" readonly> 
                                                                                </div>
                                                                            </td>

                                                                            <td>
                                                                                <div class="input-group"> 
                                                                                    <input type="date" name="production_date" class="form-control" style="width: 150px;" id="production_date" value="<%= users.production_date %>" readonly> 
                                                                                </div>
                                                                            </td>

                                                                            <td>
                                                                                <div class="input-group"> 
                                                                                    <input type="date" name="expiry_date" class="form-control" style="width: 150px;" id="expiry_date" value="<%= users.expiry_date %>" readonly> 
                                                                                </div>
                                                                            </td>
                                                                            
                                                                            <!-- <td> -->
                                                                            <!-- <div class="input-group">  -->
                                                                                <input type="hidden" name="secondary_code" class="form-control" style="width: 150px;" id="secondary_code<%= users.product_code+x %>" value="<%= users.secondary_code %>" readonly> 
                                                                            <!-- </div> -->
                                                                            <!-- </td> -->

<!--                                                                             
                                                                            <td>
                                                                                <div class="input-group"> 
                                                                                   <input type="number" name="requested_qty" class="form-control" style="width: 150px;" id="requested_qty<%= users.product_code+x %>" onkeyup="ValidationForMaxQTY('<%= users.product_code %>', '<%= x %>')" value="<%= users.requested_qty %>" readonly> 
                                                                               </div>
                                                                           </td> -->


                                                                            
                                                                            <td>
                                                                                 <div class="input-group"> 
                                                                                    <input type="number" name="prod_qty" class="form-control" style="width: 150px;" id="prod_qty<%= users.product_code+x %>" onkeyup="ValidationForMaxQTY('<%= users.product_code %>', '<%= x %>')" value="<%= users.quantity %>" readonly> 
                                                                                </div>
                                                                            </td>
                                                                            
                                                                            
                                                                            <td>
                                                                                <input type="text" name="prod_unit" class="form-control" style="width: 150px;" value="<%= users.standard_unit %>" readonly>
                                                                            </td>

                                                                            <td>
                                                                                <input type="text" name="test" class="form-control" style="width: 150px;" value="<%= users.maxperunit +" "+ users.secondary_unit %>" readonly>
                                                                            </td>
                                                                            
                                                                            <!-- <td> -->
                                                                                <input type="hidden" name="prod_secondunit" class="form-control" style="width: 150px;" value="<%= users.secondary_unit %>" readonly>
                                                                            <!-- </td> -->

                                                                            <td>
                                                                                <% var Location =  users.storage + users.rack + users.bay + users.bin + users.type[0] + users.floorlevel%>


                                                                                <input type="text" name="prod_level" class="form-control" style="width: 150px;" value="<%= users.room_name %>" readonly>
                                                                                
                                                                            </td>


                                                                            <td>
                                                                                    <% var Location =  users.storage + users.rack + users.bay + users.bin + users.type[0] + users.floorlevel%>


                                                                                    <input type="text" name="prod_level" class="form-control" style="width: 150px;" value="<%= Location %>" readonly>
                                                                                    
                                                                            </td>


                                                                            <td>
                                                                            
                                                                                <input type="text" name="prod_level" class="form-control" style="width: 150px;" value="<%= users.delivery_code %>" readonly>
                                                                                
                                                                             </td>
 
                                                                    

                                                                        


                                                                            <!-- <td>
                                                                                <input type="text" name="delivery_date" id="delivery_date" class="form-control" style="width: 150px;" value="<%= users.delivery_date %>" readonly>
                                                                            </td>

                                                                            <td>
                                                                                <input type="text" name="delivery_code" id="delivery_code" class="form-control" style="width: 150px;" value="<%= users.delivery_code %>" readonly>
                                                                            </td> -->

                                                                            

                                                                        </tr>
                                                                        
                                                                        <input type="hidden" name="MaxStocks_data" id="MaxStocks_data<%= users.product_code+x %>" class="form-control" value="<%= users.maxStocks %>" readonly>
                                                                        <input type="hidden" name="MaxStocks_data2" id="MaxStocks_data2<%= users.product_code+x %>" class="form-control" value="<%= users.maxStocks %>" readonly>
                                                                        <input type="hidden"  class="form-control" id="storage" name="storage" value="<%= users.storage %>" readonly>
                                                                        <input type="hidden"  class="form-control" id="rak" name="rak" value="<%= users.rack %>" readonly>
                                                                        
                                                                        <% x++; %>
                                                                    <% }) %>
                                                                    <input type="hidden"  class="form-control" id="last_val" value="<%= x %>" readonly>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-8 col-sm-6">
                                                            <div class="form-group">
                                                                <label for="note"><%= language.note %> </label>
                                                                <input type="text" class="form-control" value="<%= user.note %>"
                                                                    placeholder="note" id="note" name="note">
                                                            </div>
                                                    </div>

                                                    <!-- <div class="row">
                                                        <button class="btn btn-primary" type="submit"
                                                            id="submit">Finalize </button>
                                                    </div> -->
                                                </form>

                                                
                                            </div>
                                            <!-- <% if(user.finalize == "False"){ %>
                                                <div class="row">
                                                   <button class="btn btn-primary" type="submit"
                                                       id="submit" onclick="confirmAlert()">Finalize </button>
                                               </div>
                                            <% } %> -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--**********************************
            Content body end
        ***********************************-->

                    <!--**********************************
            Footer start
        ***********************************-->
                    <%- include('./partials/footer'); -%>

                        <!--**********************************
            Footer end
        ***********************************-->

    </div>
    <!--**********************************
        Main wrapper end
    ***********************************-->

    <!-- start Toastr -->
    <%- include('./partials/toastr'); -%>
        <!-- End Toastr -->

        <!--**********************************
        Scripts
    ***********************************-->

        <%- include('./partials/script'); -%>

        <script>
            function confirmAlert(){
            Swal.fire({
                icon: 'warning',
                title: 'Are you sure want to finalize?',
                text: 'Warning: After finalizing the data, it becomes locked and unmodifiable. ',
                showDenyButton: true,
                showCancelButton: false,
                confirmButtonText: 'Save',
                denyButtonText: `Don't save`,
            }).then((result) => {
           
            if (result.isConfirmed) {
                document.getElementById("form").submit();
            } else if (result.isDenied) {
                Swal.fire('Changes are not saved', '', 'info')
            }
            })

            }
        </script>
    

            <!--**********************************
        Scripts end
    ***********************************-->
</body>

</html>