<div class="container-fluid">
    <div class="card">
        <div class="card-header">
            <h4 class="card-title">Raw Materials</h4>
        </div>
    </div>
    <div class="row">

        <div class="col-lg-3">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Incoming</h4>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <canvas id="myLineChart" width="400" height="400"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-3">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Outgoing</h4>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <canvas id="myLineChart1" width="400" height="400"></canvas>
                    </div>
                </div>
            </div>
        </div>

         <div class="col-lg-3">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Adjustment</h4>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <canvas id="myLineChart2" width="400" height="400"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-3">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Transfer</h4>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <canvas id="myLineChart3" width="400" height="400"></canvas>
                    </div>
                </div>
            </div>
        </div>


        <!-- <div class="col-xl-3 col-xxl-6 col-lg-6 col-sm-6">
            <div class="widget-stat card bg-danger">
                <div class="card-body  p-4">
                    <div class="media">
                        <span class="me-3">
                            <i class="lab la-buffer"></i>
                        </span>
                        <div class="media-body text-white text-end">
                            <p class="mb-1"><%= language.categories %></p>
                            <h3 class="text-white"><%= categories %></h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-xxl-6 col-lg-6 col-sm-6">
            <div class="widget-stat card bg-success">
                <div class="card-body p-4">
                    <div class="media">
                        <span class="me-3">
                            <i class="lab la-product-hunt"></i>
                        </span>
                        <div class="media-body text-white text-end">
                            <p class="mb-1"><%= language.products %></p>
                            <h3 class="text-white"><%= product %></h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-xxl-6 col-lg-6 col-sm-6">
            <div class="widget-stat card bg-primary">
                <div class="card-body p-4">
                    <div class="media">
                        <span class="me-3">
                            <svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <g> 
                                  <g> 
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M9.55851 21.4562C5.88651 21.4562 2.74951 20.9012 2.74951 18.6772C2.74951 16.4532 5.86651 14.4492 9.55851 14.4492C13.2305 14.4492 16.3665 16.4342 16.3665 18.6572C16.3665 20.8802 13.2505 21.4562 9.55851 21.4562Z" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M9.55849 11.2776C11.9685 11.2776 13.9225 9.32356 13.9225 6.91356C13.9225 4.50356 11.9685 2.54956 9.55849 2.54956C7.14849 2.54956 5.19449 4.50356 5.19449 6.91356C5.18549 9.31556 7.12649 11.2696 9.52749 11.2776H9.55849Z" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                    <path d="M16.8013 10.0789C18.2043 9.70388 19.2383 8.42488 19.2383 6.90288C19.2393 5.31488 18.1123 3.98888 16.6143 3.68188" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                    <path d="M17.4608 13.6536C19.4488 13.6536 21.1468 15.0016 21.1468 16.2046C21.1468 16.9136 20.5618 17.6416 19.6718 17.8506" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                  </g>
                                </g>
                            </svg>
                        </span>
                        <div class="media-body text-white text-end">
                            <p class="mb-1"><%= language.supplier %></p>
                            <h3 class="text-white"><%= suppliers %></h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-xxl-6 col-lg-6 col-sm-6">
            <div class="widget-stat card bg-warning">
                <div class="card-body p-4">
                    <div class="media">
                        <span class="me-3">
                            <svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <g> 
                                  <g> 
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M11.9724 20.3683C8.73343 20.3683 5.96643 19.8783 5.96643 17.9163C5.96643 15.9543 8.71543 14.2463 11.9724 14.2463C15.2114 14.2463 17.9784 15.9383 17.9784 17.8993C17.9784 19.8603 15.2294 20.3683 11.9724 20.3683Z" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M11.9725 11.4488C14.0985 11.4488 15.8225 9.72576 15.8225 7.59976C15.8225 5.47376 14.0985 3.74976 11.9725 3.74976C9.84645 3.74976 8.12245 5.47376 8.12245 7.59976C8.11645 9.71776 9.82645 11.4418 11.9455 11.4488H11.9725Z" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                    <path d="M18.3622 10.3915C19.5992 10.0605 20.5112 8.93254 20.5112 7.58954C20.5112 6.18854 19.5182 5.01854 18.1962 4.74854" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                    <path d="M18.9431 13.5444C20.6971 13.5444 22.1951 14.7334 22.1951 15.7954C22.1951 16.4204 21.6781 17.1014 20.8941 17.2854" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                    <path d="M5.58372 10.3915C4.34572 10.0605 3.43372 8.93254 3.43372 7.58954C3.43372 6.18854 4.42772 5.01854 5.74872 4.74854" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                    <path d="M5.00176 13.5444C3.24776 13.5444 1.74976 14.7334 1.74976 15.7954C1.74976 16.4204 2.26676 17.1014 3.05176 17.2854" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                  </g>
                                </g>
                              </svg>
                        </span>
                        <div class="media-body text-white text-end">
                            <p class="mb-1"><%= language.customer %></p>
                            <h3 class="text-white"><%= customer %></h3>
                        </div>
                    </div>
                </div>
            </div>
        </div> -->

    </div>

    <!-- <div class="row">
        <div class="col-lg-3">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Products for Raw Materials</h4>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                   

                        <div>
                            <div class="widget-stat card bg-primary">
                                <div class="card-body  p-4">
                                    <div class="media">
                                        <span class="me-3">
                                            <i class="lab la-buffer"></i>
                                        </span>
                                        <div class="media-body text-white text-end">
                                            <p class="mb-1">No of Products</p>
                                            <h3 class="text-white"><%= product_cnt %>></h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-9">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Chart</h4>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <canvas id="myChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div> -->

</div>



<script>
    // Get the context of the canvas element we want to select
    var ctx = document.getElementById('myLineChart').getContext('2d');
    var ctx1 = document.getElementById('myLineChart1').getContext('2d');
    var ctx2 = document.getElementById('myLineChart2').getContext('2d');
    var ctx3 = document.getElementById('myLineChart3').getContext('2d');

    
    //Raw Material
    function fetchData() {
        // Make an AJAX request
        console.log("1")
        $.ajax({
            url: './raw_line', // Replace 'your_data_endpoint_url_here' with your actual data endpoint URL
            type: 'GET',
            dataType: 'json',
            success: function(response) {
                // On success, update chart with fetched data
                // console.log(response)
                updateChart(response);
            },
            error: function(xhr, status, error) {
                console.error(error);
            }
        });
    }
    function fetchDataOut() {
        // Make an AJAX request
        $.ajax({
            url: './raw_out_line', // Replace 'your_data_endpoint_url_here' with your actual data endpoint URL
            type: 'GET',
            dataType: 'json',
            success: function(response) {
                // On success, update chart with fetched data
                // console.log(response)
                updateChartOut(response);
            },
            error: function(xhr, status, error) {
                console.error(error);
            }
        });
    }
    function fetchDataADJ() {
        // Make an AJAX request
        $.ajax({
            url: './raw_adj_line', // Replace 'your_data_endpoint_url_here' with your actual data endpoint URL
            type: 'GET',
            dataType: 'json',
            success: function(response) {
                // On success, update chart with fetched data
                // console.log(response)
                updateChartADJ(response);
            },
            error: function(xhr, status, error) {
                console.error(error);
            }
        });
    }
    function fetchDataTF() {
        // Make an AJAX request
        $.ajax({
            url: './raw_trf_line', // Replace 'your_data_endpoint_url_here' with your actual data endpoint URL
            type: 'GET',
            dataType: 'json',
            success: function(response) {
                // On success, update chart with fetched data
                // console.log(response)
                updateChartTRF(response);
            },
            error: function(xhr, status, error) {
                console.error(error);
            }
        });
    }


    function updateChart(data) {
        var labels = [];
        var quantities = [];

        // Extract labels and quantities from fetched data
        data.forEach(function(item) {
            
            var dob = new Date(item.date);
            var dobArr = dob.toDateString().split(' ');
            var dobFormat = dobArr[2] + ' ' + dobArr[1] + ' ' + dobArr[3];
            // alert(dobFormat); 
            labels.push(dobFormat);
            quantities.push(item.totalQuantity);
        });

        // Update chart data with fetched data
        myLineChart.data.labels = labels;
        myLineChart.data.datasets[0].data = quantities;

        // Update the chart
        myLineChart.update();
    }
    function updateChartOut(data) {
        var labels = [];
        var quantities = [];

        // Extract labels and quantities from fetched data
        data.forEach(function(item) {
            
            var dob = new Date(item.date);
            var dobArr = dob.toDateString().split(' ');
            var dobFormat = dobArr[2] + ' ' + dobArr[1] + ' ' + dobArr[3];
            // alert(dobFormat); 
            labels.push(dobFormat);
            quantities.push(item.totalQuantity);
        });

        // Update chart data with fetched data
        myLineChart1.data.labels = labels;
        myLineChart1.data.datasets[0].data = quantities;

        // Update the chart
        myLineChart1.update();
    }
    function updateChartADJ(data) {
        var labels = [];
        var quantities = [];

        // Extract labels and quantities from fetched data
        data.forEach(function(item) {
            
            var dob = new Date(item.date);
            var dobArr = dob.toDateString().split(' ');
            var dobFormat = dobArr[2] + ' ' + dobArr[1] + ' ' + dobArr[3];
            // alert(dobFormat); 
            labels.push(dobFormat);
            quantities.push(item.totalQuantity);
        });

        // Update chart data with fetched data
        myLineChart2.data.labels = labels;
        myLineChart2.data.datasets[0].data = quantities;

        // Update the chart
        myLineChart2.update();
    }
    function updateChartTRF(data) {
        var labels = [];
        var quantities = [];

        // Extract labels and quantities from fetched data
        data.forEach(function(item) {
            
            var dob = new Date(item.date);
            var dobArr = dob.toDateString().split(' ');
            var dobFormat = dobArr[2] + ' ' + dobArr[1] + ' ' + dobArr[3];
            // alert(dobFormat); 
            labels.push(dobFormat);
            quantities.push(item.totalQuantity);
        });

        // Update chart data with fetched data
        myLineChart3.data.labels = labels;
        myLineChart3.data.datasets[0].data = quantities;

        // Update the chart
        myLineChart3.update();
    }


    fetchData();
    fetchDataOut();
    fetchDataADJ();
    fetchDataTF();
    var options = {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true
                }
            }]
        },
        title: {
            display: true,
            text: 'Chart.js Line Chart'
        }
    };


    var myLineChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'Total Quantity',
                backgroundColor: 'rgb(255, 99, 132)',
                borderColor: 'rgb(255, 99, 132)',
                data: [],
                fill: false,
                pointStyle: 'rectRot',
                pointRadius: 5,
                pointBorderColor: 'rgb(0, 0, 0)',
                borderWidth: 1,
            }]
        },
        options: options
    });


    var myLineChart1 = new Chart(ctx1, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'Total Quantity',
                backgroundColor: 'rgb(173, 216, 230)',
                borderColor: 'rgb(173, 216, 230)',
                data: [],
                fill: false,
                pointStyle: 'rectRot',
                pointRadius: 5,
                pointBorderColor: 'rgb(0, 0, 0)',
                borderWidth: 1,
            }]
        },
        options: options
    });

    var myLineChart2 = new Chart(ctx2, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'Total Quantity - ',
                backgroundColor: 'rgb(144, 238, 144)',
                borderColor: 'rgb(144, 238, 144)',
                data: [],
                fill: false,
                pointStyle: 'rectRot',
                pointRadius: 5,
                pointBorderColor: 'rgb(0, 0, 0)',
                borderWidth: 1,
            }]
        },
        options: options
    });

    var myLineChart3 = new Chart(ctx3, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'Total Quantity - ',
                backgroundColor: 'rgb(211, 211, 211)',
                borderColor: 'rgb(211, 211, 211)',
                data: [],
                fill: false,
                pointStyle: 'rectRot',
                pointRadius: 5,
                pointBorderColor: 'rgb(0, 0, 0)',
                borderWidth: 1,
            }]
        },
        options: options
    });


    // function fetchDataAndDrawChart() {
    //         // Make AJAX call to get data
    //         var xhr = new XMLHttpRequest();
    //         xhr.open('GET', './rm_chart', true);
    //         xhr.onload = function () {
    //             if (xhr.status >= 200 && xhr.status < 300) {
    //                 var data = JSON.parse(xhr.responseText);
    //                 drawChart(data);
    //             } else {
    //                 console.error('Failed to fetch data');
    //             }
    //         };
    //         xhr.onerror = function () {
    //             console.error('Failed to fetch data');
    //         };
    //         xhr.send();
    //     }

    // function drawChart(data) {
    //     var ctx = document.getElementById('myChart').getContext('2d');
    //     var myChart = new Chart(ctx, {
    //         type: 'line',
    //         data: {
    //             labels: data.purchases.map(item => item.date),
    //             datasets: [{
    //                 label: 'Purchases',
    //                 data: data.purchases.map(item => item.totalQuantity),
    //                 backgroundColor: 'rgba(255, 99, 132, 0.2)',
    //                 borderColor: 'rgba(255, 99, 132, 1)',
    //                 borderWidth: 1
    //             },
    //             {
    //                 label: 'Sales',
    //                 data: data.sales.map(item => item.totalQuantity),
    //                 backgroundColor: 'rgba(54, 162, 235, 0.2)',
    //                 borderColor: 'rgba(54, 162, 235, 1)',
    //                 borderWidth: 1
    //             },
    //             {
    //                 label: 'Adjustment',
    //                 data: data.adjustment.map(item => item.totalQuantity),
    //                 backgroundColor: 'rgba(255, 206, 86, 0.2)',
    //                 borderColor: 'rgba(255, 206, 86, 1)',
    //                 borderWidth: 1
    //             },
    //             {
    //                 label: 'Transfer',
    //                 data: data.transfer.map(item => item.totalQuantity),
    //                 backgroundColor: 'rgba(75, 192, 192, 0.2)',
    //                 borderColor: 'rgba(75, 192, 192, 1)',
    //                 borderWidth: 1
    //             }]
    //         },
    //         options: {
    //             scales: {
    //                 y: {
    //                     beginAtZero: true
    //                 }
    //             }
    //         }
    //     });
    // }
    // fetchDataAndDrawChart();
    async function fetchDataAndUpdateChart(fetchFunction, chart) {
        const newData = await fetchFunction(); // Fetch data using the provided fetchFunction
        // chart.data = newData;
        // chart.update(); // Update the chart with the new data
        await fetchFunction(); 
    }


    function startDataRefresh() {
        const pollingInterval = 5000;
        // Call fetchDataAndUpdateChart for each data source and its corresponding chart
        setInterval(() => fetchDataAndUpdateChart(fetchData, ctx), pollingInterval);
        setInterval(() => fetchDataAndUpdateChart(fetchDataOut, ctx1), pollingInterval);
        setInterval(() => fetchDataAndUpdateChart(fetchDataADJ, ctx2), pollingInterval);
        setInterval(() => fetchDataAndUpdateChart(fetchDataTF, ctx3), pollingInterval);
    }

    startDataRefresh();
</script>